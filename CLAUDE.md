# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

- LLM アプリケーション開発コースの学習用リポジトリ
- 番号つきディレクトリで各トピックが整理されている

## Development Setup

### パッケージマネージャー

- このプロジェクトは `uv` を使用している
- `uv` の設定ファイルは @pyproject.toml である

初回セットアップ：

```bash
uv sync
uv run -m ipykernel install --sys-prefix --name python3
```

新規シェルセッションにおける初期化：

```bash
. .venv/bin/activate
```

### Python バージョン

- Python 3.12.x 以上 3.13.0 未満を必須とする
- Python 3.13.0 以降は使わないように、@.python-version と @uv.lock でロックしている

### 環境変数の扱い

- @.env で環境変数を管理している
- 2つの環境変数にそれぞれ API キーが格納されている：
    - `API_KEY`: [OpenAI Platform](https://platform.openai.com/api-keys) 用
    - `TAVILY_API_KEY`: [Tavily](https://app.tavily.com/home) 用

## Workflow Design

### 1. Plan モードを基本とする

- 3ステップ以上 or アーキテクチャに関わるタスクは、必ず Plan モードで開始する
- 途中でうまくいかなくなったら、無理に進めずすぐに立ち止まって再計画する
- 構築だけでなく、検証ステップにも Plan モードを使う
- 曖昧さを減らすため、実装前に詳細な仕様を書く

### 2. サブエージェント戦略

- メインのコンテキストウィンドウをクリーンに保つため、サブエージェントを積極的に活用する
- リサーチ、調査、並列分析はサブエージェントに任せる
- 複雑な問題には、サブエージェントを使ってより多くの計算リソースを投入する
- 集中して実行するために、サブエージェント1つにつき1タスクを割り当てる

### 3. 自己改善ループ

- ユーザーから修正を受けたら、必ず @tasks/lessons.md へそのパターンを記録する
- 同じミスを繰り返さないように、自分へのルールを書く
- ミス率が下がるまで、ルールを徹底的に改善し続ける
- セッション開始時に、そのプロジェクトに関連する @tasks/lessons.md をレビューする

### 4. 完了前に必ず検証する

- 動作を証明できるまで、タスクを完了とマークしない
- 必要に応じて main ブランチと自分の変更の差分を確認する
- 「スタッフエンジニアはこれを承認するか？」と自問する
- テストを実行し、ログを確認し、正しく動作することを示す

### 5. エレガントさを追求する（バランスよく）

- 重要な変更をする前に、「もっとエレガントな方法はないか？」と一度立ち止まる
- ハック的な修正に感じたら、今知っていることをすべて踏まえて、エレガントな解決策を実装する
- シンプルで明白な修正では、このプロセスをスキップする（過剰設計しない）
- 提示する前に、自分の作業を自問自答する

### 6. 自律的なバグ修正

- バグレポートを受けたら、手取り足取り教えてもらわずにそのまま修正する
- ログ、エラー、失敗しているテストを見て、自分で解決する
- ユーザーのコンテキスト切り替えをゼロにする
- 言われなくても、失敗している CI テストを修正しに行く

## Task Management

1. **まず計画を立てる**：チェック可能な項目として @tasks/todo.md に計画を書く
2. **計画を確認する**：実装を開始する前に確認する
3. **進捗を記録する**：完了した項目を随時マークしていく
4. **変更を説明する**：各ステップで高レベルのサマリーを提供する
5. **結果をドキュメント化する**：@tasks/todo.md にレビューセクションを追加する
6. **学びを記録する**：修正を受けた後に @tasks/lessons.md を更新する

## Core Principles

- **シンプル第一**：すべての変更をできる限りシンプルにし、影響するコードを最小限にする
- **手を抜かない**：根本原因を見つけ、一時的な修正は避け、シニアエンジニアの水準を保つ
- **影響を最小化する**：変更は必要な箇所のみにとどめ、バグを新たに引き込まない

## Testing

- `pytest` を使用してテストを実行する

## Type Checking

- `ty` と `mypy` を順番に実行して厳格な型チェックを行う
- 対象範囲は @pyproject.toml で設定されている

## Linting

- `ruff check --fix` を実行してリンティングを行う

## Formatting

- `ruff format` を実行してコード整形を行う

## Running Applications

### Testing example

- **対象**：@06_test/authenticator.py

### Flask Todo App

- **対象**：@09_flask/app.py
    - アプリケーションには http://localhost:5000 からアクセスする

### LLM App

- **対象**：@16_llmapp/original/app.py
    - API キーを使う

## Code Architecture

### 型アノテーション

- すべてのコードは `mypy` によるチェックを通らなければならない

### リンティング

- すべてのコードは `ruff check --fix` によるリンティングを通らなければならない

### コードフォーマット

- すべてのコードは `ruff format` によるコードフォーマットが実行されていなければならない
